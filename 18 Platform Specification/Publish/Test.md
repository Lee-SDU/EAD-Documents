## 测试环境发布

测试环境主要作为测试人员进行新功能测试和 Bug 修复回归测试的环境，不允许在测试环境进行功能的修改和新增功能的配置开发。

进行测试环境程序打包时同步打包生产环境程序包并添加时间序列版本号后缀，例如：gbros-web-2016080201.war，当前版本的测试环境程序包测试通过后才可以将同步打包的生产环境程序包在生产环境进行发布。

根据发布内容的更新范围可以采用整体发布、程序全量发布、配置数据全量发布、应用程序增量发布等发布方式进行。

### 整体发布流程

0. 确认本次发布更新功能范围；
- 确认开发人员已提交本次发布代码到 SVN；
- 至少 30 分钟前通知所有测试和试用人员停止服务和预计发布完成的时间，此段时间不允许提交代码或进行配置开发；
- 使用发布脚本从开发环境导出本次发布的 EAD 配置数据；
- 更新代码并确认待发布代码已提交；
- 通知开发人员可以开发环境进行配置开发或代码开发；
- 使用 Maven 打包测试环境版本的 war 包；
- 上传 war 包文件到测试环境；
- 按照通知的停止服务时间计划停止测试环境 EAD 服务；
- 备份测试环境配置数据库（ead）存放在测试环境备份目录下带有时间版本号的目录（如：20160630-001）；
- 将测试环境程序包备份存放在测试环境备份目录下带有时间版本号的目录（如：20160630-001）；
- 将本次发布的 EAD 配置数据导入测试环境 EAD 主数据库；
- 将待发布程序 war 包部署到 Tomcat 目录，启动 Tomcat 服务，检查服务启动是否成功；
- 访问测试系统基本功能及新发布功能是否正常，如果发布正常通知相关测试人员发布成功，可以进行测试环境测试工作；
- 系统功能或新发布功能不可用且无法在较短时间内修复，恢复已备份数据和程序后运行服务，通知相关测试人员发布失败并取消本次发布；

### 程序全量发布流程

0. 确认本次发布更新功能范围；
- 确认开发人员已提交本次发布代码到 SVN；
- 至少 30 分钟前通知所有测试和试用人员停止服务和预计发布完成的时间，此段时间不允许提交代码；
- 更新代码并确认待发布代码已提交；
- 通知开发人员可以开发环境进行配置开发或代码开发；
- 使用 Maven 打包测试环境版本的 war 包；
- 上传 war 包文件到测试环境；
- 按照通知的停止服务时间计划停止测试环境 EAD 服务；
- 将测试环境程序包备份存放在测试环境备份目录下带有时间版本号的目录（如：20160630-001）；
- 将待发布程序 war 包部署到 Tomcat 目录，启动 Tomcat 服务，检查服务启动是否成功；
- 访问测试系统基本功能及新发布功能是否正常，如果发布正常通知相关测试人员发布成功，可以进行测试环境测试工作；
- 系统功能或新发布功能不可用且无法在较短时间内修复，恢复已备份程序后运行服务，通知相关测试人员发布失败并取消本次发布；

### 配置数据全量发布流程

0. 确认本次发布更新功能范围；
- 至少 30 分钟前通知所有测试和试用人员停止服务和预计发布完成的时间，此段时间不允许进行配置开发；
- 使用发布脚本从开发环境导出本次发布的 EAD 配置数据；
- 通知开发人员可以开发环境进行配置开发；
- 按照通知的停止服务时间计划停止测试环境 EAD 服务；
- 备份测试环境配置数据库（ead）存放在测试环境备份目录下带有时间版本号的目录（如：20160630-001）；
- 将本次发布的 EAD 配置数据导入测试环境 EAD 主数据库；
- 启动 Tomcat 服务，检查服务启动是否成功；
- 访问测试系统基本功能及新发布功能是否正常，如果发布正常通知相关测试人员发布成功，可以进行测试环境测试工作；
- 系统功能或新发布功能不可用且无法在较短时间内修复，恢复已备份数据后运行服务，通知相关测试人员发布失败并取消本次发布；

### 程序增量发布流程

0. 确认本次发布更新功能范围；
- 至少 10 分钟前通知所有测试和试用人员停止服务和预计发布完成的时间，此段时间不允许提交代码；
- 更新代码并确认待发布代码已提交；
- 通知开发人员可以开发环境进行配置开发；
- 打包或编译 jar、Java 文件；
- 按照通知的停止服务时间计划停止测试环境 EAD 服务；
- 将测试环境程序包备份存放在测试环境备份目录下带有时间版本号的目录（如：20160630-001）；
- 将本次发布的程序文件上传并拷贝替换到指定目录；
- 启动 Tomcat 服务，检查服务启动是否成功；
- 访问测试系统基本功能及新发布功能是否正常，如果发布正常通知相关测试人员发布成功，可以进行测试环境测试工作；
- 系统功能或新发布功能不可用且无法在较短时间内修复，恢复已备份程序后运行服务，通知相关测试人员发布失败并取消本次发布；


