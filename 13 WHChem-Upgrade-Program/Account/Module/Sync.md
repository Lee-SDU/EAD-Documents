## 信息同步

当 LDAP 中发生用户账号或组织机构数据新增或变更时将变更数据通过 Web Service 的方式同步到 EAD 平台。

![LDAP 认证](../../images/ldap-sync.png)

### 同步参数

#### serviceName

参数类型：String

参数值：App_003

描述说明：目标应用名称，PI专用字段

#### type

参数类型：Ingeter

参数值：1

描述说明：同步数据的操作类型。
- ```1```，  帐号添加：在应用系统中增加一个帐号。
- ```2```，  帐号修改：修改应用系统中的一个帐号属性
- ```3```，  帐号删除：将应用系统中的帐号删除。
- ```4```，  帐号挂起：将应用系统中的帐号修改为禁用状态或锁定状态，让该帐号不能访问。
- ```5```，  帐号恢复：将应用系统中已挂起的帐号进行恢复，使帐号访问应用系统。
- ```6```，  组织添加：在应用系统中添加一条组织信息。
- ```7```，  组织修改：修改应用系统中的组织信息。
- ```8```，  组织删除：将应用中的组织信息进行删除。

#### content

参数类型：XML（String）

参数值：
```
<data>
    <uid>szzhang</uid>
</data>
```

>data 节点的具体字段信息参考用户账号和组织机构同步字段。

### 返回消息

```
<result>
    <code>同步状态响应码<code>
    <msg>
        同步失败原因，由应用方返回具体错误信息
    <msg>
</result>
```

#### 示例返回格式
```
<result>
    <code>1<code>
    <msg>
        Uid错误导致失败
    <msg>
</result>
```

> msg中如有特殊字符需要加入CDATA处理。

#### 同步状态响应码
代码|描述
--|--
0|成功
1|失败

### 用户账号信息

#### 用户账号同步字段

属性名称|LDAP|EAD|数据类型|说明
:--|:--|:--|:--|:--
用户 ID|uid||String|具有唯一性且不可随意变更的主键
账号|uid||String|具有唯一性的用户账号
姓名|cn||String|一般为用户的真实姓名
英文名称|||String|
简称|shortName||String|
显示名称|||String|wanhuaCn与uid拼接起来：韩晓明（xmhan）
邮箱|mail||String|用户主要的电子邮箱地址
手机号码|mobile||String|主要联系电话
性别|sex||String|
出生日期|birthday||String|出生日期(格式：1990-1-1)
公司名称|||String|所属公司名称
公司 ID|unit||String|所属公司唯一 ID
所属组织机构名称|||String|组织机构名称
所属组织机构 ID|unitCode||String|组织机构唯一 ID
兼职组织机构名称|||String|兼职组织机构名称
兼职组织机构ID|vdeptNo||String|兼职组织机构唯一 ID
用户状态|||String|

#### 同步规则

- 添加：应用账号所有属性字段;
- 修改：仅应用账号变更属性字段;
- 删除：仅应用账号唯一标识属性字段;
- 挂起：仅应用账号唯一标识属性字段;
- 恢复：仅应用账号唯一标识属性字段;

### 组织机构信息

#### 组织机构同步字段

属性名称|LDAP|EAD|数据类型|说明
:--|:--|:--|:--|:--
组织机构 ID|erglobalid||String|具有唯一性且不可随意变更的主键
组织名称|ou||String|组织机构全称
组织英文名称|ou;lang-en||String|组织机构英文全称
组织简称|||String|简称
组织缩写|||String|
组织编码|orgunitid||String|便于机器或程序识别的字母或数字编码
父级组织ID|erparent||String|
组织描述|description||String|
是否显示|isDisplay||Boolean|控制组织机构是否显示在选人接口&人力地图&是否同步到组(0不显示，1显示)（true-显示/false-不显示）
组织路径|||String|
组织层级|orgLevel||String|
组织类型|orgType||String|0：部门,1：公司,2：组织单元
组织序号|displayNumber||String|
组织状态|||String|

#### 同步规则

- 添加：应用组织所有属性字段;
- 修改：仅组织机构变更属性字段;
- 删除：仅组织唯一标识属性字段;

### 信息同步异常处理

- EAD 平台信息更新或新增信息失败时记录异常操作日志;
- 对于个别账号的异常处理可以对比 LDAP 数据手工在 EAD 平台编辑更新;
- 如果有大量信息同步失败需要按照数据批量导入的方式清除并批量导入用户账号或组织机构信息。
