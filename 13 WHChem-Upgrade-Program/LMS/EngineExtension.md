## EAD  扩展开发

为实现通过 PI 与物流系统实现外运车卡激活、注销和过磅数据同步，需要在“固废外运处置”视图分别增加车卡激活、车卡注销、过磅同步的自定义后端驱动。

驱动 URI 命名空间：```hwmsOutTransferAction```

### 车卡激活

**驱动名称：** hwmsCardActive

**驱动类型：** 视图动作

**驱动URI：** ```hwmsOutTransferAction/cardActive```

**驱动功能：**
0. 获取视图列表选定的数据；
- 判断外运处置状态为“联系外运”，如果状态有误进行错误提醒并结束返回；
- 判断选定的外运处置记录是否存在车卡号、车牌号等数据，如果数据有缺失进行错误提醒并结束返回；
- 参考接口协议中的“固废外运车卡信息同步（激活、更新、注销）”接口通过 PI 向物流系统发起车卡激活（状态：1）请求；
- 物流系统返回成功后更新外运处置状态为“物流发卡”后返回成功提醒，如果物流系统返回错误直接返回错误提醒并结束。

### 车卡注销

**驱动名称：** hwmsCardSignout

**驱动类型：** 视图动作

**驱动URI：** ```hwmsOutTransferAction/signout```

**驱动功能：**

0. 获取视图列表选定的数据；
- 判断外运处置状态为“物流发卡”，如果状态有误进行错误提醒并结束返回；
- 参考接口协议中的“固废外运车卡信息同步（激活、更新、注销）”接口通过 PI 向物流系统发起车卡注销（状态：0）请求；
- 物流系统返回成功后更新外运处置状态为“物流注销”后返回成功提醒，如果物流系统返回错误直接返回错误提醒并结束。

### 过磅同步

**驱动名称：** hwmsCarWeightSync

**驱动类型：** 视图动作

**驱动URI：** ```hwmsOutTransferAction/syncWeight```

**驱动功能：**

0. 参考协议接口中的“固废外运车辆过磅数据同步”接口接收物流系统通过 PI 发起的过磅数据同步请求；
- 根据物流系统请求的参数，根据业务单号查询关联的外运处置单信息；
- 判断外运处置单状态为“物流发卡”；
- 更新写入过磅同步数据；
- 车辆直接外运过磅数据均分处理；
- 更新外运处置单状态为“过磅同步”；
- 按照接口协议返回成功消息。




